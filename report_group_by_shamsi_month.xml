<?xml version="1.0" encoding="utf-8"?>
<modification>
<name>Report group by shamsi month</name>
<code>report_group_by_shamsi_month</code>
<version>1.0.0.0</version>
<author>zs-madani</author>
<!--Sale shiping -->
<file path="admin/controller/extension/report/sale_shipping.php">
<operation>
<search><![CDATA[class ControllerExtensionReportSaleShipping extends Controller {]]></search>
<add position="before"><![CDATA[
require_once(DIR_SYSTEM . 'library/jdf.php');
]]></add>
</operation>
<operation>
<search><![CDATA[$results = $this->model_extension_report_sale->getShipping($filter_data);]]></search>
<add position="after"><![CDATA[
if ($filter_group == 'month') {
$grouped_results = array();

foreach ($results as $result) {
$timestamp_start = strtotime($result['date_start']);
$timestamp_end = strtotime($result['date_end']);

$jdate = jdate('Y-n', $timestamp_start);
list($jyear, $jmonth) = explode('-', $jdate);

$padded_month = str_pad($jmonth, 2, '0', STR_PAD_LEFT);
$group_key = $jyear . '-' . $padded_month;

if (!isset($grouped_results[$group_key])) {
$grouped_results[$group_key] = array(
'date_start' => $result['date_start'],
'date_end' => $result['date_end'],
'title' => $result['title'],
'orders' => 0,
'total' => 0
);
}

$grouped_results[$group_key]['orders'] += $result['orders'];
$grouped_results[$group_key]['total'] += $result['total'];

if (strtotime($result['date_start']) < strtotime($grouped_results[$group_key]['date_start'])) {
$grouped_results[$group_key]['date_start'] = $result['date_start'];
}
if (strtotime($result['date_end']) > strtotime($grouped_results[$group_key]['date_end'])) {
$grouped_results[$group_key]['date_end'] = $result['date_end'];
}
}
$results = array_values($grouped_results);
}
]]></add>
</operation>
</file>

<!--Sale Tax -->
<file path="admin/controller/extension/report/sale_tax.php">
<operation>
<search><![CDATA[class ControllerExtensionReportSaleTax extends Controller {]]></search>
<add position="before"><![CDATA[
require_once(DIR_SYSTEM . 'library/jdf.php');
]]></add>
</operation>
<operation>
<search><![CDATA[$results = $this->model_extension_report_sale->getTaxes($filter_data);]]></search>
<add position="after"><![CDATA[
if ($filter_group == 'month') {
$grouped_results = array();

foreach ($results as $result) {
$timestamp_start = strtotime($result['date_start']);
$timestamp_end = strtotime($result['date_end']);

$jdate = jdate('Y-n', $timestamp_start);
list($jyear, $jmonth) = explode('-', $jdate);

$padded_month = str_pad($jmonth, 2, '0', STR_PAD_LEFT);
$group_key = $jyear . '-' . $padded_month;

if (!isset($grouped_results[$group_key])) {
$grouped_results[$group_key] = array(
'date_start' => $result['date_start'],
'date_end' => $result['date_end'],
'title' => $result['title'],
'orders' => 0,
'total' => 0
);
}

$grouped_results[$group_key]['orders'] += $result['orders'];
$grouped_results[$group_key]['total'] += $result['total'];

if (strtotime($result['date_start']) < strtotime($grouped_results[$group_key]['date_start'])) {
$grouped_results[$group_key]['date_start'] = $result['date_start'];
}
if (strtotime($result['date_end']) > strtotime($grouped_results[$group_key]['date_end'])) {
$grouped_results[$group_key]['date_end'] = $result['date_end'];
}
}
$results = array_values($grouped_results);
}
]]></add>
</operation>
</file>
<!--Sale Return -->
<file path="admin/controller/extension/report/sale_return.php">
<operation>
<search><![CDATA[class ControllerExtensionReportSaleReturn extends Controller {]]></search>
<add position="before"><![CDATA[
require_once(DIR_SYSTEM . 'library/jdf.php');
]]></add>
</operation>
<operation>
<search><![CDATA[$results = $this->model_extension_report_return->getReturns($filter_data);]]></search>
<add position="after"><![CDATA[
if ($filter_group == 'month') {
$grouped_results = array();

foreach ($results as $result) {
$timestamp_start = strtotime($result['date_start']);
$timestamp_end = strtotime($result['date_end']);

$jdate = jdate('Y-n', $timestamp_start);
list($jyear, $jmonth) = explode('-', $jdate);

$padded_month = str_pad($jmonth, 2, '0', STR_PAD_LEFT);
$group_key = $jyear . '-' . $padded_month;

if (!isset($grouped_results[$group_key])) {
$grouped_results[$group_key] = array(
'date_start' => $result['date_start'],
'date_end' => $result['date_end'],
'title' => $result['title'],
'orders' => 0,
'total' => 0
);
}

$grouped_results[$group_key]['orders'] += $result['orders'];
$grouped_results[$group_key]['total'] += $result['total'];

if (strtotime($result['date_start']) < strtotime($grouped_results[$group_key]['date_start'])) {
$grouped_results[$group_key]['date_start'] = $result['date_start'];
}
if (strtotime($result['date_end']) > strtotime($grouped_results[$group_key]['date_end'])) {
$grouped_results[$group_key]['date_end'] = $result['date_end'];
}
}
$results = array_values($grouped_results);
}
]]></add>
</operation>
</file>
<!--Sale Order -->
<file path="admin/controller/extension/report/sale_order.php">
<operation>
<search><![CDATA[class ControllerExtensionReportSaleOrder extends Controller {]]></search>
<add position="before"><![CDATA[
require_once(DIR_SYSTEM . 'library/jdf.php');
]]></add>
</operation>
<operation>
<search><![CDATA[$results = $this->model_extension_report_sale->getOrders($filter_data);]]></search>
<add position="after"><![CDATA[
if ($filter_group == 'month') {
$grouped_results = array();

foreach ($results as $result) {
$timestamp_start = strtotime($result['date_start']);
$timestamp_end = strtotime($result['date_end']);

$jdate = jdate('Y-n', $timestamp_start);
list($jyear, $jmonth) = explode('-', $jdate);

$padded_month = str_pad($jmonth, 2, '0', STR_PAD_LEFT);
$group_key = $jyear . '-' . $padded_month;

if (!isset($grouped_results[$group_key])) {
$grouped_results[$group_key] = array(
'date_start' => $result['date_start'],
'date_end' => $result['date_end'],
'title' => $result['title'],
'orders' => 0,
'total' => 0
);
}

$grouped_results[$group_key]['orders'] += $result['orders'];
$grouped_results[$group_key]['total'] += $result['total'];

if (strtotime($result['date_start']) < strtotime($grouped_results[$group_key]['date_start'])) {
$grouped_results[$group_key]['date_start'] = $result['date_start'];
}
if (strtotime($result['date_end']) > strtotime($grouped_results[$group_key]['date_end'])) {
$grouped_results[$group_key]['date_end'] = $result['date_end'];
}
}
$results = array_values($grouped_results);
}
]]></add>
</operation>
</file>
</modification>